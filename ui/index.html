<!-- WebApp for masterplan graph copilot / IAAC Thesis 2025 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DIONYSUS</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/x-icon" href="./assets/ico.svg" type="image/svg+xml">

  <!-- Libraries (loaded early, but with defer so DOM is ready first) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js" defer></script>
  <script src="https://unpkg.com/three@0.150.1/build/three.min.js" defer></script>
  <script src="https://unpkg.com/3d-force-graph" defer></script>

  <!-- App scripts (defer to keep ordering and avoid race conditions) -->
  <script src="app.js" defer></script>
  <script src="chat.js" defer></script>
</head>

<body>
  <!-- 3D Graph background -->
  <div id="graph3d-container" aria-label="3D Graph">
    <div id="graph3d"></div>
  </div>

  <!-- loading chip -->
  <div id="graph-loading" role="status" aria-live="polite">
    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    <span class="label">Generating graphâ€¦</span>
  </div>

  <!-- Top bar -->
  <header class="topbar">
    <div class="brand">Andromeda</div>
    <div id="status" class="status" aria-live="polite" title="Backend status">Disconnected</div>
  </header>

  <main class="stage" aria-label="graph and controls">
    <div class="pill-group">
      <!-- Context pill with dropdown -->
      <div class="pill context-pill" id="contextPill" tabindex="0" aria-haspopup="true" aria-expanded="false">
        <span>Context</span>
        <div class="dropdown context-form" id="contextForm" role="dialog" aria-label="Set geospatial context">
          <label>Lat: <input type="number" step="any" id="latInput" /></label>
          <label>Long: <input type="number" step="any" id="longInput" /></label>
          <label>Radius (m): <input type="number" step="any" id="radiusInput" /></label>
          <button id="saveContextBtn" type="button">Set</button>
        </div>
      </div>

      <!-- Brief upload pill -->
      <div class="pill upload-pill empty" role="button" tabindex="0" aria-controls="brief-upload" aria-label="Upload brief (PDF)">
        <span id="uploadLabel">Brief</span>
        <input type="file" id="brief-upload" accept=".pdf" />
      </div>

      <!-- Rhino parameters -->
      <button class="pill icon-pill" id="rhinoPill" aria-haspopup="true" aria-expanded="false" title="Rhino options">
        <img src="assets/rhino3d.svg" alt="Rhino3D" />
      </button>
      <!-- Rhino panel -->
      <div class="dropdown" id="rhinoForm" role="dialog" aria-label="Rhino options">
        <div class="toggle-row">
          <label class="toggle-label" for="togglePlot">Plot graph</label>
          <label class="switch">
            <input type="checkbox" id="togglePlot" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <label class="toggle-label" for="toggleContext">Context graph</label>
          <label class="switch">
            <input type="checkbox" id="toggleContext" />
            <span class="slider"></span>
          </label>
        </div>

        <button id="bakeBtn" class="rhino-bake-btn" type="button">Bake masterplan</button>
      </div>
    </div>

    <!-- Bottom-centered tabs -->
    <div class="tab" role="tablist" aria-label="Graph views">
      <button class="active" data-tab="context" role="tab" aria-selected="true">Context Graph</button>
      <button class="brief" data-tab="brief" role="tab" aria-selected="false">Brief Graph</button>
      <button data-tab="massing" role="tab" aria-selected="false">Massing Graph</button>
      <button data-tab="enriched" role="tab" aria-selected="false">Enriched Graph</button>
      <button data-tab="masterplan" role="tab" aria-selected="false">Masterplan Graph</button>
    </div>

    <!-- Chat -->
    <section class="chat" aria-label="Chat">
      <div id="chat-history" class="chat-history">
        <div id="chat-resize-handle" class="chat-resize-handle" title="Drag to resize"></div>
        <div class="history-content"></div>
      </div>

      <form class="chat-input-bar" onsubmit="return false;">
        <input id="chat-input" class="chat-input-pill" placeholder="Ask anything..." aria-label="Chat input" />
        <button id="chat-send" class="chat-send-circle" aria-label="Send">
          <span class="visually-hidden">Send</span>
        </button>
      </form>
    </section>
  </main>
</body>
</html>
