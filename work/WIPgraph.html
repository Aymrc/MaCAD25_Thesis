<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title>Massing Graph Viewer</title>
    <style>
      html, body, #graph { margin:0; height:100%; overflow:hidden; }
      #file { position:absolute; z-index:10; top:10px; left:10px; background:#fff; }
    </style>
    <script src="https://unpkg.com/3d-force-graph"></script>
  </head>


  <body>
    <input type="file" id="file" accept=".json"/>
    <div id="graph"></div>
    <script>
      const mount = document.getElementById('graph');
      const Graph = ForceGraph3D()(mount)
        .nodeLabel(n => `${n.building_id || ''} L${n.level}`)
        .nodeAutoColorBy('building_id');

      // Load default graph on startup
      const defaultPath = '../knowledge/massing_graph.json'; // adjust if needed
      fetch(defaultPath)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          Graph.graphData({
            nodes: data.nodes || [],
            links: data.links || data.edges || []
          });
        })
        .catch(err => {
          console.warn('Could not load default graph:', err);
        });

      // File input to load another JSON
      document.getElementById('file').addEventListener('change', e => {
        const f = e.target.files[0];
        if (!f) return;
        const r = new FileReader();
        r.onload = () => {
          try {
            const data = JSON.parse(r.result);
            Graph.graphData({
              nodes: data.nodes || [],
              links: data.links || data.edges || []
            });
          } catch (err) {
            console.error('Invalid JSON:', err);
          }
        };
        r.readAsText(f);
      });
    </script>

  </body>
</html>
